<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rocket Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; text-align: center; }
        #game-ui { display: block; padding: 20px; }
        .rocket-box { height: 200px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        #rocket-vid { width: 200px; display: none; }
        .stat { font-size: 40px; font-weight: bold; margin: 20px 0; }
        button { width: 100%; padding: 20px; background: #007aff; color: #fff; border: none; border-radius: 15px; font-size: 18px; }
    </style>
</head>
<body>
    <div id="game-ui">
        <div style="display:flex; justify-content: space-between; color: #34c759;">
            <span>ONLINE: <b id="on">0</b></span>
            <span>БАЛАНС: <b id="bal">500</b></span>
        </div>
        
        <div id="status" style="margin-top: 20px; color: #007aff;">Підключення до сервера...</div>
        <div class="stat" id="x-val">1.00x</div>
        
        <div class="rocket-box">
            <video id="rocket-vid" autoplay muted loop playsinline>
                <source src="https://files.catbox.moe/gkhz5v.mp4">
            </video>
        </div>

        <button id="main-btn" onclick="doAction()">СТАВКА</button>
    </div>

    <script>
        // Ініціалізація Telegram
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Підключення до твого Render сервера
        const socket = io("https://rocket-multiplayer.onrender.com", {
            transports: ["websocket", "polling"]
        });

        let currentX = 1.0;
        let isFlying = false;

        // Слухаємо дані від сервера
        socket.on("gameUpdate", (data) => {
            document.getElementById('on').innerText = data.online;
            const status = document.getElementById('status');
            const xVal = document.getElementById('x-val');
            const vid = document.getElementById('rocket-vid');

            if (data.phase === "wait") {
                isFlying = false;
                status.innerText = "Очікування: " + data.timer + "с";
                status.style.color = "#007aff";
                vid.style.display = "none";
                xVal.innerText = "1.00x";
            } 
            else if (data.phase === "fly") {
                isFlying = true;
                status.innerText = "У ПОЛЬОТІ";
                status.style.color = "#fff";
                vid.style.display = "block";
                xVal.innerText = data.currentX + "x";
                currentX = parseFloat(data.currentX);
            } 
            else if (data.phase === "boom") {
                isFlying = false;
                status.innerText = "BOOM!";
                status.style.color = "#ff3b30";
                vid.style.display = "none";
            }
        });

        // Якщо сервер не відповідає
        socket.on("connect_error", () => {
            document.getElementById('status').innerText = "Сервер прокидається (зачекайте 30с)...";
        });

        function doAction() {
            // Тут буде логіка ставки
            alert("Ставка прийнята! Очікуйте раунду.");
        }
    </script>
</body>
</html>
